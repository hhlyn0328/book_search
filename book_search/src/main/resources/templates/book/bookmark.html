<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorator="layout/main_layout">
<th:block layout:fragment="html_head">
	<title>Book Search</title>
</th:block>

<th:block layout:fragment="custom_css">
</th:block>
<th:block layout:fragment="custom_js">
<script th:inline="javascript">
/*<![CDATA[*/

	var page = /*[[${pageHelper.currentPageNum}]]*/ 1;
	var pageSize = /*[[${pageHelper.pageSize}]]*/ 10;
	var token = /*[[${_csrf.token}]]*/ '';
	var header = /*[[${_csrf.headerName}]]*/ '';
		
 	$(function() {
	    $(document).ajaxSend(function(e, xhr, options) {
	        xhr.setRequestHeader(header, token);
	    });
	}); 
	
	function move(num){
		page = num;
		call();
	}
	
	function changeSize(size){
		pageSize = size;
		call();
	}
	
	function call(){
		var uri = StringFormat("{0}?page={1}&pageSize={2}",
				pageUri, page, pageSize);
		
		location.href = uri;
	}
	
	function deleteBookMark(no){
		 $.ajax({
			url: "/book/bookmark/remove",
			data: { bookmarkNo : no },
			method: "POST",
			success: function(result){
				if(result == "Success"){
					location.reload();
				}		
			}
		}) 
	}

/*]]>*/
</script>
</th:block>

<th:block layout:fragment="content_body" >
	<div class="content-wrapper">
	<div th:include="fragments/main_navbar :: mainNav" th:with="navid='bookmark'"></div>
		<div class="container">
			<div class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-md-6">
							<h3>책 검색 북마크</h3>
						</div>
					</div>
					
				</div>

			</div>

			<div class="card">
				<div class="card-body">					
					<table class="table table-bordered" style="margin-top: 20px;">
						<thead class="thead-dark">
							<tr>
								<th scope="col">#</th>
								<th scope="col">제목</th>
								<th scope="col">출판사</th>
								<th scope="col">작가</th>
								<th scope="col">검색일</th>
								<th scope="col">북마크해제</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="bookmark : ${bookmarks}">
								<td><img th:attr="src=@{${bookmark.thumbnail}}" /></td>								
								<td><a th:text="${bookmark.title}" th:href="@{${bookmark.url}}" target="_blank"></a></td>
								<td th:text="${bookmark.publisher}"></td>
								<td th:text="${bookmark.authors}"></td>
								<td th:text="${bookmark.createDate}"></td>
								<td>
									<button th:onclick="|deleteBookMark('${bookmark.no}')|" class="btn btn-outline-warning active">북마크</button>
								</td>							
							</tr>
							<tr th:if="${pageHelper.empty}">
								<td colspan="6">검색결과가 없습니다.</td>
							</tr>
						</tbody>
					</table>
					<div th:replace="fragments/pagenation :: pagenation" th:with="pageHelper=${pageHelper}" ></div>
				</div>
			</div>
		</div>

	</div>
</th:block>

</html>